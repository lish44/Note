# Barrier
--------

### 概念 

是一种 屏障指令，它使得cup或编译器对屏障指令的 **前和后** 所发出的内存操作
执行一个排序的约束。也叫内存栅栏 或 栅栏指令

### 作用

1. 阻止屏障两边的指令重排序
2. 写数据加写屏障，会强制把写缓冲区的数据刷回到主内存中
3. 读数据加读屏障，会让工作内存/cpu高速缓存的数据失效，重新到主内存获取新数据

### 类型

**Load Barrier** : 读指令 **之前** 插入读屏障，让工作内存/CPU高速缓存当中缓存的数据失效，重新到主内存中获取新的数据

读屏障：在多线程环境中，一个线程A正在修改全局变量x，另一个线程B需要读取x的最新值。如果不使用读屏障，线程B很可能读取到未修改完的旧值。因此，在线程A修改x时，加上读屏障，使得线程B在读取x之前必须等待线程A修改完成，保证线程B读取的是最新的x的值。

**Store Barrier** : 写指令 **之后** 插入写屏障，强制把写缓冲区的数据刷回到主内存中

写屏障：在一个线程写入全局变量时，另一个线程读取该全局变量，如果不加内存屏障，读取到的可能是旧的数据。那么在写入前加上内存屏障，保证了读取操作是在写入操作之后执行的，从而避免出现这种情况。

### volatile

![pic](https://raw.githubusercontent.com/lish44/pic/main/res/202207311800032.png)

![pic](https://raw.githubusercontent.com/lish44/pic/main/res/202207311802569.png)
