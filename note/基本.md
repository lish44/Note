### ç±»å‹

int

string

uint32

uint64

### åŒ… ä½ç½® ç¯å¢ƒå˜é‡

#### ä½ç½®

`go env` å¯æŸ¥çœ‹ go çš„ç¯å¢ƒæ‰€æœ‰å˜é‡

`GOROOT` å°±æ˜¯å®‰è£…ä½ç½®ä¸€èˆ¬å°±åœ¨`/usr/local/go`è·¯å¾„ä¸‹

`GOPATH` å°±æ˜¯ Go é¡¹ç›®ä»£ç å­˜æ”¾çš„ä½ç½® è¿™ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç›®å½• å°±å¥½æ¯”æ˜¯å…¶ä»– IDE çš„ Workspace

`go get` å’Œ `go install` å‘½ä»¤ä¼šä¸‹è½½ go ä»£ç åˆ° GOPATH

`go run` æ¯æ¬¡ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œå°†ä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶æ”¾å…¥å…¶ä¸­ï¼Œæ‰§è¡Œå®Œåè¿™ä¸ªç›®å½•ä¼šè¢«åˆ é™¤

`go build` ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆwindowä¸‹ .exe)ï¼Œæ–‡ä»¶ä¸ä¼ å…¥çš„æ–‡ä»¶æˆ–åŒ…åä¸€è‡´ï¼Œå¦‚æœæƒ³è‡ªå®šä¹‰ç”¨ `-o` æ ‡å¿— (ex:`go build -o hello_world hello.go` )

--------

#### ç¯å¢ƒå˜é‡

shell ä¸­ä¸»è¦é…è¿™

```zsh
export GO111MODULE=on
export GOPATH="$HOME/WorkSpace/go"
export GOPROXY="https://goproxy.cn"
```

[è¯¦æƒ…](https://blog.csdn.net/qq_38151401/article/details/105729884)

ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢åªæœ‰ä¸€ä¸ª mod ï¼Œå½“å‰æ–‡ä»¶å¤¹ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å…±äº« **å…¨å±€å˜é‡** **å…¨å±€å‡½æ•°**ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶æ—¶å¯å’ŒåŒ…åç›¸åŒï¼Œå…¶ä»–éšæ„

--------

#### å¼•å…¥åŒ…é—®é¢˜

`go mod tidy` ä¼šè‡ªåŠ¨ä¸‹è½½ import é‡Œçš„åŒ…åˆ° GOPATH ä¸‹

ä¸‹è½½çš„ç¬¬ä¸‰æ–¹ä¾èµ–åº“å­˜åœ¨ `GOPATH/pkg/mod` ä¸‹

`go install` ä¸‹è½½çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨`GOPATH/bin`

#### æŸ¥æ‰¾é¡ºåº
å·¥ä½œç›®å½• -> GOPATH/pkg/mod -> GOROOT/src

**ä¸‰æ–¹åŒ…**

GO111MODULE å¼€å¯åä¼šä½¿ç”¨ mod æ¨¡å¼ ï¼Œå³ install æˆ– get ä¸‹è½½çš„åŒ…ä¼šä¸‹åˆ° GOPATH/pkg/mod/ ä¸‹

**æœ¬åœ°åŒ…**

1.18 ä¹‹å ç”¨ work

ä¸€èˆ¬ä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œ æ–‡ä»¶å¤¹å†…ç”¨ `go mod init <company.com/module_name>` åˆ›å»º mod æ–‡ä»¶

`company.com/module_name` å°±æ˜¯ import æ—¶çš„å¡«çš„æ¨¡å—åï¼Œpackage çš„åŒ…åä¸ç”¨å’Œæ¨¡å—åä¸€æ ·ï¼Œä½†ä¸€èˆ¬éƒ½ä¸€æ ·ï¼Œ**ä½†æ˜¯åŒ…åœ¨ä¸€ä¸ªæ¨¡å—ä¸‹åªèƒ½æœ‰ä¸€ä¸ª**

`go work init` å¯åœ¨å·¥ä½œæ ¹ç›®å½•å¯åˆ›å»º go.work æ–‡ä»¶ï¼Œç”¨äºæ–‡ä»¶ç®¡ç†

`go work use ./<module_file>` æŠŠå…¶ä»–æ¨¡å—æ·»åŠ è¿› go.work çš„ use ç»“æ„ä¸­

- <module_file>å…¶å®å°±æ˜¯ä¸Šé¢çš„ä¸€ä¸ªæ¨¡å—æ–‡ä»¶å¤¹ï¼ŒæŠŠè·¯å¾„å†™è¿›å»äº†ï¼Œå…¶ä»–æ¨¡å—å» work é‚£ä¹Ÿå°±æ‰¾å¾—åˆ°äº†ï¼Œä½†å®é™…ä¸Šæ‰¾çš„æ˜¯æ¨¡å—æ–‡ä»¶å¤¹å†…çš„ go.mod æ–‡ä»¶é‡Œ
  é¢çš„ company.com/module_nameï¼Œä¹Ÿå°±æ˜¯è¦ import çš„ä¸œè¥¿ï¼Œç”±äºä¸€ä¸ªæ¨¡å—åªèƒ½å­˜åœ¨ä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶å°±æ‰¾åˆ°äº†å¯¹åº”çš„ package

  1.18 ä¹‹å‰ç”¨ replace

å¼•å…¥æœ€é‡è¦çš„æ˜¯é…ç½® go.mod æ–‡ä»¶ éœ€è¦ç”¨ replace æ¥ç‰¹æ®ŠæŒ‡å®šå½“å‰åŒ…(module)çš„ä½ç½®

![ç»“æ„](https://raw.githubusercontent.com/lish44/pic/main/res/202206110137300.png)

```tree
XX
â”œâ”€â”€ afile
â”‚Â Â  â”œâ”€â”€ afile.go
â”‚Â Â  â”œâ”€â”€ cao2.go
â”‚Â Â  â””â”€â”€ go.mod
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ main.go
```

- å½“å‰å®éªŒç›®å½•æ˜¯åœ¨ GOPATH/XX æ–‡ä»¶å¤¹å†…è¿›è¡Œ
- `./` å½“å‰æ–‡ä»¶å½“åšæ ¹ä½ç½® `../` å½“å‰æ–‡ä»¶ä¸Šçº§ç›®å½•ä½ç½®ï¼Œmod é…ç½®æ—¶å¿…é¡»åŠ  `./` ç±»ä¼¼è·¯å¾„
- foo åå­—éšæ„ä½†å¿…é¡»è¦åŠ ï¼Œä¸€èˆ¬æ˜¯å…¬å¸åå­— ex: `company.com/module_name`
- afile ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å…¨å±€å‡½æ•°æˆ–å˜é‡å…¬ç”¨<font color=#bf616a>ï¼ˆéœ€é¦–å­—æ¯å¤§å†™ï¼‰</font>
- å¼•å…¥å¹¶ç”¨åˆ«å

  ```go
  import (
  	af "foo/afile"
  )
  ```

~~import æ—¶ä¼šå…ˆä»`GOROOT/src`ä¸‹æ‰¾ï¼Œç„¶åå†å» `GOPATH/src` æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æ‰¾åˆ° å°±æŠ¥é”™æ‰¾ä¸åˆ° package~~

~~ex: import "huahua/models" å®é™…ä¸Šæ‰¾çš„å°±æ˜¯ GOROOT/src/huahua/models è¿™ä¸ªåŒ…ï¼Œæ²¡æ‰¾åˆ°å°±éµä»ä¸Šé¢è§„åˆ™~~

--------

### channel

> åœ¨ go ä¸­ goroutine çš„äº¤æµé€”å¾„ç”¨ **channel** æ¥å®ç°

> <font color=#bf616a>Don't conmmunicate by sharing memory; share memory by communicating</font>

> äº¤æµæ˜¯åŒå‘çš„ å‘æ¶ˆæ¯å’Œæ”¶æ¶ˆæ¯éƒ½ä¼šé˜»å¡ä»£ç ï¼Œ<font color=#bf616a>ç›´åˆ°å¯¹æ–¹æ¥æ”¶åˆ°</font>

åˆ›å»ºæ— ç¼“å­˜channel

`ch := make(chan string)`

åˆ›å»ºæœ‰ç¼“å­˜channelï¼Œå®¹é‡ä¸èƒ½ä¿®æ”¹

`ch := make(chan int, 10)`

åªè¯»channel ?

`ch := make(<-chan float32)` 

åªå†™channel ?

`ch := make(chan<- float32)` 

ä¸€èˆ¬ç”¨äºé€šçŸ¥çš„channel

`ch := make(chan struct{})` 

`len` è¿”å›å½“å‰ç¼“å†²åŒºæœ‰å¤šå°‘ä¸ªå€¼ï¼Œ`cap` è¿”å›ç¼“å†²åŒºå¤§å°


- å¸¦æ•°æ®ç±»å‹

è¯»å†™ ex:

```go
func main() {
	// åˆ›å»ºæ— ç¼“å­˜channel
	ch := make(chan string)
	go huahua(5, "ğŸ¤¡", ch)

	// è‡ªæ—‹ç­‰å¾…æ¥æ”¶
	for {
		// è¯»æ“ä½œ å¦‚æœæ²¡æœ‰å†™æ“ä½œè¿™é‡Œä¼šä¸€ç›´è¯»é€ æˆæ­»é”ï¼Œè¿™ä¸ªdeadlockå¹¶ä¸æ˜¯ for å¼•å‘çš„è€Œæ˜¯channelè¯»å†™çš„è‡ªèº«é˜»å¡
		msg, err := <-ch
		if !err {
			break
		}
		fmt.Println(msg)
	}

	// ç®€å†™
	// for msg := range ch {
	// 	fmt.Println(msg)
	// }
	fmt.Println("====== main func exit ======")
}

func huahua(n int, str string, ch chan string) {
	defer close(ch)
	for i := 0; i < n; i++ {
		// å†™æ“ä½œ
		ch <- str
		time.Sleep(time.Millisecond * 500)
	}
}
```

- channel : çš„è¯»å†™éœ€è¦å¯¹åº”
- defer : ä¿è¯å‡½æ•°åœ¨å‡ºæ ˆå‰æœ€åä¸€åˆ»æ‰§è¡Œ
- close(ch) : æ¯ä¸ª channel éœ€è¦ä¿è¯é€€å‡ºï¼Œä¸ç„¶ä¼šé€ æˆæ­»é”ï¼Œ<font color=#bf616a>ä¸€èˆ¬æ˜¯è´Ÿè´£å†™æ“ä½œçš„grtåœ¨å†™æ“ä½œå®Œæˆåå…³é—­é€šé“ã€‚
å¦‚æœ **å¤šä¸ªgrt** åŒæ—¶å†™å…¥ä¸€ä¸ªchannelï¼Œæ­¤æ—¶å°å¿ƒå…¶ä¸­ä¸€ä¸ªå°†å…¶å…³é—­ï¼Œå¦‚æœå…³äº†ä¼šå¼•å‘panicï¼Œè§£å†³åŠæ³•å°±æ˜¯<font color=#a3be8c>sync.WaitGroup</font> </font>

ç®€å•çš„è¯»å†™æ­»é”æ¡ˆä¾‹ ex:

```go
func main() {
	ch <- "test"// å†™
	msg := <- ch// è¯»
	fmt.Println(msg)
	close(ch)
}
```

- ch æ²¡æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œåœ¨ç¬¬ä¸€è¡Œè¿›è¡Œå†™æ“ä½œæ—¶ä»£ç ä¼šé˜»å¡ï¼Œä¼šç­‰å¾…ä¸€ä¸ªå¯¹åº”çš„è¯»æ“ä½œï¼Œè€Œè¯»æ“ä½œåœ¨ä¸‹ä¸€è¡Œï¼Œé€»è¾‘ä¸Šæ°¸è¿œç­‰ä¸åˆ°ï¼Œæ‰€ä»¥é€ æˆæ­»é”ã€‚
- å¦‚æœä¸€äºŒè¡Œäº¤æ¢ å…ˆè¯»åå†™ï¼Œæƒ…å†µä¹Ÿä¸€æ ·ã€‚å› ä¸ºæ²¡æœ‰å†™è€Œæ— æ³•è¯»ï¼Œé€ æˆæ­»é”ã€‚
- è§£å†³åŠæ³•ç®€å• å°±æ˜¯å¼€ä¸¤æ¡çº¿ç¨‹å¹¶å‘è¯»å†™

```go

func main() {
	ch := make(chan string, 0)

	go func() {
		ch <- "test"
	}()

	go func() 
		// rangeä¼šè‡ªåŠ¨æ£€æµ‹å…³é—­channel
		for msg := range ch {
			fmt.Println(msg)
		}
	}()

	time.Sleep(time.Millisecond * 1) // å¦‚æœä¸å†™è¿™å¥ï¼Œmainå‡½æ•°çš„goroutineç»“æŸåï¼Œæ‰€æœ‰grtéƒ½ä¼šç»“æŸ

	/** æˆ–è€…ç›´æ¥è®©è¯»åœ¨mainé‡Œç›´æ¥è·‘èµ·æ¥
	ch := make(chan string)
	go func() {
		ch <- "test"
		close(ch)
	}()
	for msg := range ch {
		fmt.Println(msg)
	}
	*/

}
```
--------

è¯»å†™é¡ºåºä¸ä¸€è‡´é€ æˆæ­»é”

```go
func main() {
	ch1 := make(chan int)
	ch2 := make(chan int)
	go func() {
		v := 1
		ch1 <- v//6
		v2 := <-ch2
		fmt.Println(v, v2)
	}()
	v := 2//11
	ch2 <- v
	v2 := <-ch1
	fmt.Println(v, v2)
}
```
- è¿™é‡Œ6å’Œ11è¡Œç”±äºéƒ½åœ¨ç­‰å†™æ“ä½œå‘ç”Ÿé˜»å¡ï¼Œä½†ç”±äºä¸¤ä¸ªgrtéƒ½åœ¨ç­‰å¯¹æ–¹å‘äº†ä¹‹åæ‰æ‰§è¡Œå†™æ“ä½œï¼Œçº¿ç¨‹æ˜¯å¹¶å‘çš„ï¼ˆè¿™é‡Œcupç‰©ç†ä¸ŠçœŸæ­£æ‰§è¡Œæ—¶æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œï¼Ÿï¼‰é€»è¾‘ï¼ˆfuncå†…çš„é€»è¾‘ï¼‰æ˜¯ä¸²è¡ŒåŒæ­¥çš„ï¼Œ
æ‰€ä»¥é€»è¾‘ä¸Šæ°¸è¿œç­‰ä¸‹å»ï¼Œé€ æˆæ­»é”
- è§£å†³åŠæ³•å°±æ˜¯ <font color=#bf616a>select</font> ï¼Œ~~æˆ–è€…æŠŠè¯»å–é¡ºåºå†™å¯¹ï¼ˆå¢åŠ å¿ƒæ™ºè´Ÿæ‹…ï¼‰~~

--------

### å¼‚æ­¥

##### ä½¿ç”¨ sync.WaitGroup è®¡æ•°ç®¡ç†

```Go
func main() {
	var wg sync.WaitGroup
	wg.Add(2)

	// åŒ¿åå‡½æ•°+ç«‹å³æ‰§è¡Œ
	go func() {
		huahua(3, "ğŸ‘»")
		// huahua æ‰§è¡Œå®Œæˆå è®¡æ•°å™¨-1
		wg.Done()
	}()

	go func() {
		huahua(3, "ğŸ¤¡")
		wg.Done()
	}()

	wg.Wait()// é˜»å¡

	fmt.Println("====== main func exit ======")
}

// print func
func huahua(n int, str string) {
	for i := 0; i < n; i++ {
		fmt.Println(i+1, ": ", str)
		time.Sleep(time.Millisecond * 500)
	}
}
```

- `wg.Add()` æ·»åŠ è®¡æ•°ä¸ªæ•°
- `wg.Wait()` ç¨‹åºé˜»å¡ ç­‰å¾…è®¡æ•°å™¨ä¸º 0 æ¢å¤æ‰§è¡Œ , wg è¦ç¡®ä¿ goroutine æ‰§è¡Œå®Œæˆä¸ç„¶ä¼šå‡ºç° **deadlock**
- `wg.Done()` è®¡æ•°-1

### åˆ é™¤ go

root æƒé™

`rm -rf /usr/local/go`

`rm -rf /etc/paths.d/go`

åˆ é™¤æœ‰å…³ go çš„ç¯å¢ƒå˜é‡é…ç½®

`vim ~/.bash_profile` || `vim ~/.zshrc`

### interface

> **åœ¨ golang ä¸­ interface å°±æ˜¯ä¸€ä¸ªç±»å‹ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»å‹**

> æ‰€æœ‰ç±»å‹éƒ½å¯è½¬åŒ–æˆç©º interface

#### æŸ¥çœ‹å½“å‰ interface å˜é‡å­˜çš„ç±»å‹

fmt

```go
fmt.Printf("%T\n", T)
```

åå°„

```go
func typeof(v interface{}) string {
    return reflect.TypeOf(v).String()
}
```

æ–­è¨€

`val, ok := element.(T)`

- val æ˜¯
- element æ˜¯ interface ç±»å‹
- ok bool ç±»å‹ ç¡®è®¤è¿™ä¸ª interface ç±»å‹æ˜¯å¦æœ‰ T è¿™ä¸ªç±»å‹å­˜åœ¨
- T æ–­è¨€çš„ç±»å‹

--------

### slice

åº•å±‚æ˜¯æ•°ç»„ï¼Œåˆ‡ç‰‡æœ¬èº«æœ‰ä¸‰ä¸ªå±æ€§ `ptr *Elem` `len int` `cap int` ï¼Œ

![pic](https://raw.githubusercontent.com/lish44/pic/main/res/202207012312221.png)

å‡½æ•°å€¼ä¼ é€’æ—¶ï¼Œä¼ é€’åªæ˜¯ä¸ªæµ…æ‹·è´çš„å˜é‡åœ°å€ï¼Œåº•å±‚å¼•ç”¨çš„ä¸‰ä¸ªå±æ€§æ˜¯è¿˜æ˜¯ä¸€æ ·çš„

 
### defer
å¯ä»¥ç†è§£æˆå¿«ç…§ï¼Œä¼šcaptureè¿™æ¡è¯­å¥ä¹‹ä¸Šçš„å€¼ï¼Œå¦‚æœdeferçš„æ˜¯funcé‚£ä¹ˆcaptrueçš„æ˜¯è¿™ä¸ªåšä½œç”¨åŸŸå…§æœ€åçš„å€¼

æ‰“å°é¡ºåºç›¸åï¼ˆæ ˆï¼‰
```go
func main() {
	defer fmt.Println("1")
	defer fmt.Println("2")
	defer fmt.Println("3")
	// 3 2 1
}
```

defer åœ¨returnå‰æ‰§è¡Œ 
```go
func main() {
	fmt.Println("main: ", foo())
}

func foo() (v int) {
	v = 10
	defer func() {
		fmt.Println("def: ", v)
	}()
	return v + 1
}
// def:  11
// main:  11
```
- defer æ•è·äº†vï¼Œvç”±äºå£°æ˜åœ¨äº†è¿”å›å€¼ä¸Šï¼ˆä¿å­˜åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸­ï¼‰ï¼Œæ‰€ä»¥ä¸º11ï¼Ÿ
- å¦‚æœè¿”å›å€¼ä¸Šçš„vä¸å†™ï¼Œåˆ™æ•è·çš„å±€éƒ¨væ‰“å°å°±æ˜¯10


### stack frame

å‡½æ•°è°ƒç”¨è§„çº¦

<font color=#bf616a>åœ¨goä¸­å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°ï¼Œæ˜¯ä¿å­˜åœ¨cellerçš„æ ˆå¸§ä¸­</font>
![pic](https://raw.githubusercontent.com/lish44/pic/main/res/202207301505749.png)
